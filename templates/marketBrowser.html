{{define "body"}}
<script>
	$(document).ready(function() {
				var sellOrders = $('#sellOrders').dataTable( {
	 					"searching": false,
	 					"paging": false,
	 					"scrollY": "200px",
	 					"lengthChange": false,
	 					"info": false,
	 					"order": [[ 1, "asc" ]],
	 					"sAjaxDataProp": "",
	 				    "aoColumns": [
							{ "mData": "stationName" },
							{ "mData": "price" },
							{ "mData": "quantity" },
						],
						"columnDefs": [
   							{ className: "row-right-align", "targets": [ 1, 2 ] }
  						]
    				} );
				var buyOrders = $('#buyOrders').dataTable( {
	 					"searching": false,
	 					"paging": false,
	 					"scrollY": "200px",
	 					"lengthChange": false,
	 					"info": false,
	 					"order": [[ 1, "desc" ]],
	 					"sAjaxDataProp": "",
	 				    "aoColumns": [
							{ "mData": "stationName" },
							{ "mData": "price" },
							{ "mData": "quantity" },
						],
						"columnDefs": [
   							{ className: "row-right-align", "targets": [ 1, 2 ] }
  						]					
				} );
			} );
</script>
<h3>Market Browser</h3>
<div id="itemSearchContainer">
	<input class="typeahead" type="text" placeholder="Item Search">
	<button id="highsec" type="button" class="btn btn-primary btn-sm sec active" data-toggle="button">HighSec</button>
	<button id="lowsec" type="button" class="btn btn-primary btn-sm sec" data-toggle="button">LowSec</button>
	<button id="nullsec" type="button" class="btn btn-primary btn-sm sec" data-toggle="button">NullSec</button>
</div>
<h4>Sell Orders</h4>
<div class="insideContainer">
	<table id="sellOrders" class="table table-striped" cellspacing="0" width="100%">
		<thead>
			<tr>
				<th>stationName</th>
				<th>price</th>
				<th>quantity</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
</div>
<h4>Buy Orders</h4>
<div class="insideContainer"> 
	<table id="buyOrders" class="table table-striped" cellspacing="0" width="100%">
		<thead>
			<tr>
				<th>stationName</th>
				<th>price</th>
				<th>quantity</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
</div>


<script type="text/javascript">
	$('#itemSearchContainer')
	.removeClass( 'display' )
	.addClass('table table-striped table-bordered');
		
	var itemSearch = new Bloodhound({
	   sufficient: 100,
	   limit: 100,
	   datumTokenizer: function (datum) {
	       return Bloodhound.tokenizers.whitespace(datum.value);
	   },
	   queryTokenizer: Bloodhound.tokenizers.whitespace,
	   remote: {
	       url: '/J/searchItems?q=%QUERY',
	       filter: function (itemSearch) {
	           return $.map(itemSearch.rows, function (itemSearch) {
	               return {
	                   value: 	itemSearch.TypeName,
	                   id:		itemSearch.TypeID
	               };
	           });
	       }
	   }
	});
	
	// Initialize the Bloodhound suggestion engine
	itemSearch.initialize();
	var datum;
	
	$('#itemSearchContainer .typeahead').typeahead(null, {
		name: 'itemSearch',
		limit: 100,
		display: 'value',
		source: itemSearch.ttAdapter()
	}).on('typeahead:selected', function(obj, d, name) {
		datum = d;
		resetFlags();
	});

	
	$('.sec').click(function () {
		setTimeout(resetFlags, 50);
	});

	function resetFlags() {
		var secFlags = {High: 1, Low: 2, Null: 4};
		var f;
		if ($('#highsec').hasClass('active')) {
			f = f | secFlags.High;
		}
		if ($('#lowsec').hasClass('active')) {
			f = f | secFlags.Low;
		}
		if ($('#nullsec').hasClass('active')) {
			f = f | secFlags.Null;
		}
		$('#sellOrders').dataTable().api().ajax.url('/J/marketSellRegionItems?itemID='+datum.id+"&secflags="+f).load();
		$('#buyOrders').dataTable().api().ajax.url('/J/marketBuyRegionItems?itemID='+datum.id+"&secflags="+f).load();
	}
	</script>
{{end}}