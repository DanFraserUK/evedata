{{define "base"}}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="icon" href="/i/favicon.ico">
		<title>{{.Title}}</title>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2043836-4', 'auto');
  ga('send', 'pageview');

</script>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-7592797392299801",
    enable_page_level_ads: true
  });
</script>
		<script src="/js/site.js"></script>
		<script src="/js/murmur3.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
		
		<script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-growl/1.0.6/bootstrap-growl.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/locale/bootstrap-table-en-US.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.4/typeahead.bundle.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/js/bootstrap-select.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.3/js.cookie.min.js"></script>

		<link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css">
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/css/bootstrap-select.min.css">
		<link rel="stylesheet" href="/css/site.css">
	</head>
	<body>
		<nav class="navbar navbar-default navbar-static-top">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#"><img src="/images/logo.png" alt="EVEData"></a>
				</div>
				
				<div id="navbar" class="navbar-collapse collapse">
					<ul class="nav navbar-nav">
						<li class="active">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Characters <span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu">
								<li><a href="/assets">Assets</a></li>
							</ul>
						</li>
						<li class="active">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Market <span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu">
								<li><a href="/arbitrageCalculator">Arbitrage Calculator</a></li>
								<li><a href="/">Market Search</a></li>
								<li><a href="/iskPerLP">ISK Per Loyalty Points</a></li>
							</ul>
						</li>
						<li class="active">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Tools <span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu">
								<li><a href="/ecmjam">ECM Jam Chance</a></li>
								<li><a href="/localIntel">Local Intel Summary</a></li>
							</ul>
						</li>
						<li class="active">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Wars <span class="caret"></span></a>
							<ul class="dropdown-menu" role="menu">
								<li><a href="/activeWars">Active Wars</a></li>
								<li><a href="/contactSync">Contact Sync</a></li>
							</ul>
						</li>						
					</ul>
					<script>
						var accountInfo;
						function updateCursor(id, name) {
							$.ajax({
								url: "/X/cursorChar?cursorCharacterID=" + id,
								type: 'post',
								success: function () {
									accountInfo.cursor.cursorCharacterID = id;
									accountInfo.cursor.cursorCharacterName = name;
									updateCursorDisplay();
								},
							});
						}

						function updateCursorDisplay() {
							if (accountInfo.cursor && accountInfo.cursor.cursorCharacterID > 0) {
								$("#cursorName").text(accountInfo.cursor.cursorCharacterName)
								$("#cursorImage").attr("src",characterImageByID(accountInfo.cursor.cursorCharacterID, 32));  
							}
						}

						$('body').on('click', function(event) {
							var target = $(event.target);
							if (target.parents('.bootstrap-select').length) {
								target.parents('.bootstrap-select').toggleClass('open');
								return false;
							}
						});	
					
						$.getJSON("/X/accountInfo", function(json){
							accountInfo = json;
							$("#noAuth").hide()
							$("#authed").show()
							if (!accountInfo.cursor || accountInfo.cursor.cursorCharacterID == 0) {
								if (accountInfo.characters && accountInfo.characters[0].tokenCharacterID) {
									updateCursor(accountInfo.characters[0].tokenCharacterID, accountInfo.characters[0].characterName)
								} else {
									showAlert('No characters available. Please add characters on the account page.', 'danger');
								}
							}
							
							updateCursorDisplay();

							$("#accountImage").attr("src",characterImageByID(accountInfo.characterID, 64));  
							$("#accountName").text(accountInfo.characterName)

							$.each(accountInfo.characters, function(key, val) {	
								if (val.tokenCharacterID == accountInfo.cursor.cursorCharacterID) {		
                  					$('#cursorCharacter').append('<option value=' + val.tokenCharacterID + ' SELECTED><img src="' + characterImageByID(val.tokenCharacterID, 32) + '" width=32 height=32>' + val.characterName + '</option>');
								} else {
                  					$('#cursorCharacter').append('<option value=' + val.tokenCharacterID + '><img src="' + characterImageByID(val.tokenCharacterID, 32) + '" width=32 height=32>' + val.characterName + '</option>');									
								}
							})

							$('#cursorCharacter').selectpicker('refresh')
						}).fail(function() {
							$("#notloggedin").show();
						});

						$("body").on("change", "#cursorCharacter", function() {
							updateCursor($('#cursorCharacter').val(), $('#cursorCharacter option:selected').text());
						});
					</script>

					<div class="nav navbar-nav navbar-right pull-right" style="padding: 9px">
						<div id="noAuth">
							<a href="/X/eveAuth"><img src="/images/EVE_SSO_Login_Buttons_Small_Black.png" style="padding: 0px"></a>
						</div>
						<div id="authed" style="display: none;">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<img src="" id="cursorImage"> 
									<strong id="cursorName">Some Dude</strong>
									<span class="glyphicon glyphicon-chevron-down"></span>
								</a>
								<ul class="dropdown-menu">
									<li>
										<div class="navbar-login">
											<div class="row">
												<div class="col-lg-4">
													<p class="text-center">
														<img src="" id="accountImage"> 
													</p>
												</div>
												<div class="col-lg-8">
													<p class="text-left"><strong>Logged in with:</strong> <span id="accountName"></p>						
												</div>
											</div>
										</div>
									</li>
									<li class="divider"></li>
									<li>
										<div class="navbar-login navbar-login-session">
											<div class="row">
												<div class="col-lg-12 text-center">
													<p><strong>UI Control Character</strong></p>
													<select class="selectpicker" data-width="auto" id="cursorCharacter"></select>
												</div>
											</div>
										</div>
									</li>										
									<li class="divider"></li>
									<li>
										<div class="navbar-login navbar-login-session">
											<div class="row">
												<div class="col-lg-12">													<p class="text-left">
														<a href="/account" class="btn btn-primary btn-block btn-sm">Account & Characters</a>
														<a href="/X/logout" class="btn btn-danger btn-block">Logout</a>
													</p>													
												</div>
											</div>
										</div>
									</li>
								</ul>
							</li>	
						</div>				
					</div>
				</div>
			</div>
		</nav>
		{{template "ads-adaptive" .}}
		<div class="container-fluid" id="mainContainer">
			{{template "body" .}}
		</div>
	</body>
</html>
{{end}}

{{define "ads-adaptive"}}
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- EVEData Responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7592797392299801"
     data-ad-slot="5613186081"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
{{end}}

{{define "checkAuthentication"}}
<p class="ed_alert" id="notloggedin" style="display: none;">This page requires you to be authenticated with active charaters in your account.<br>
		Please <a href="/X/eveAuth">log in with EVE Online</a> and add some characters to your account.</p>
{{end}}
